<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة معلومات سياسات بنك الدم التفاعلية 2023</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts (Cairo for Arabic) -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #FDF2F2;
            color: #1F2937;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb {
            background: #EF4444;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover { background: #DC2626; }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .active-tab { background-color: #EF4444; color: white; border-bottom: 2px solid #991B1B; }
        .inactive-tab { background-color: white; color: #4B5563; border: 1px solid #E5E7EB; }
        .inactive-tab:hover { background-color: #FEF2F2; }
    </style>
</head>
<body class="bg-red-50 min-h-screen flex flex-col">

    <!-- Header Section -->
    <header class="bg-white shadow-md border-b-4 border-red-600 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4 space-x-reverse">
                <div class="text-4xl text-red-600 animate-pulse">❤</div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">سياسات بنك الدم 2023</h1>
                    <p class="text-sm text-gray-500">الهيئة العامة للتأمين الصحي - الإدارة العامة للخدمات الطبية</p>
                </div>
            </div>
            <button onclick="window.print()" class="hidden md:block bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded transition">
                طباعة التقرير
            </button>
        </div>
    </header>

    <!-- Main Navigation -->
    <nav class="container mx-auto px-4 mt-6">
        <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
            <button onclick="switchTab('principles')" id="tab-principles" class="active-tab py-3 px-4 rounded-t-lg font-bold shadow-sm transition duration-300">
                الميثاق الأخلاقي
            </button>
            <button onclick="switchTab('operations')" id="tab-operations" class="inactive-tab py-3 px-4 rounded-t-lg font-bold shadow-sm transition duration-300">
                حركة المخزون
            </button>
            <button onclick="switchTab('quality')" id="tab-quality" class="inactive-tab py-3 px-4 rounded-t-lg font-bold shadow-sm transition duration-300">
                ضبط الجودة والإعدام
            </button>
            <button onclick="switchTab('kpi')" id="tab-kpi" class="inactive-tab py-3 px-4 rounded-t-lg font-bold shadow-sm transition duration-300">
                مؤشرات الأداء
            </button>
            <button onclick="switchTab('pdf')" id="tab-pdf" class="inactive-tab py-3 px-4 rounded-t-lg font-bold shadow-sm transition duration-300">
                الوثيقة الأصلية
            </button>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="container mx-auto px-4 py-6 bg-white shadow-lg rounded-b-lg rounded-tr-lg min-h-[600px] mb-10">

        <!-- SECTION 1: ETHICAL PRINCIPLES -->
        <section id="section-principles" class="fade-in">
            <!-- ... (نفس الكود السابق) ... -->
            <!-- Cards and content ... -->
        </section>

        <!-- SECTION 2: OPERATIONS -->
        <section id="section-operations" class="hidden fade-in">
            <!-- ... (نفس الكود السابق) ... -->
        </section>

        <!-- SECTION 3: QUALITY CONTROL -->
        <section id="section-quality" class="hidden fade-in">
            <!-- ... (نفس الكود السابق) ... -->
        </section>

        <!-- SECTION 4: KPIs -->
        <section id="section-kpi" class="hidden fade-in">
            <!-- ... (نفس الكود السابق) ... -->
        </section>

        <!-- SECTION 5: ORIGINAL POLICY PDF -->
        <section id="section-pdf" class="hidden fade-in">
            <div class="mb-8 border-b pb-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">خامساً: الوثيقة الأصلية (للعرض المباشر)</h2>
            </div>
            <div class="w-full h-[80vh] min-h-[500px] border-4 border-gray-200 rounded-xl overflow-hidden shadow-xl">
                <!-- IFRAME to embed PDF - uses a placeholder path -->
                <iframe src="blood_bank_policy.pdf" class="w-full h-full" frameborder="0">
                    متصفحك لا يدعم عرض ملفات PDF المدمجة. يمكنك <a href="blood_bank_policy.pdf" class="text-red-600 font-bold">تحميل الملف من هنا</a>.
                </iframe>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm">تم إنشاء هذه المنصة التفاعلية بناءً على وثيقة سياسات بنك الدم - الهيئة العامة للتأمين الصحي</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- State Management ---
        const appState = {
            currentTab: 'principles',
            rejectionData: {
                labels: ['انتهاء الصلاحية', 'إيجابية الفيروسات', 'تكسير (Haemolysis)', 'دهون (Lipemia)', 'صفراء (Icterus)', 'إيجابي كومبس', 'عدم اكتمال الحجم'],
                data: [35, 10, 15, 20, 10, 5, 5],
                colors: ['#9CA3AF', '#EF4444', '#F87171', '#FBBF24', '#FCD34D', '#60A5FA', '#34D399'],
                descriptions: {
                    'انتهاء الصلاحية': 'الوحدات التي تجاوزت المدة المسموح بها للتخزين ولم يتم استخدامها.',
                    'إيجابية الفيروسات': 'الوحدات التي أثبتت التحاليل احتوائها على فيروسات (مثل الكبد الوبائي B/C أو الإيدز).',
                    'تكسير (Haemolysis)': 'تلف وتكسر كرات الدم الحمراء داخل الكيس، مما يجعل الدم غير صالح للنقل وقد يسبب خطورة للمريض.',
                    'دهون (Lipemia)': 'ظهور مصل الدم بلون حليبي نتيجة ارتفاع نسبة الده��ن عند المتبرع.',
                    'صفراء (Icterus)': 'ارتفاع نسبة البيليروبين (الصفراء) في دم المتبرع، مما يشير لمشاكل صحية ويستوجب استبعاد الوحدة.',
                    'إيجابي كومبس': 'وجود أجسام مضادة غير متوقعة في دم المتبرع (Coombs Positive)، مما قد يسبب تفاعلات مناعية للمريض.',
                    'عدم اكتمال الحجم': 'توقف عملية التبرع قبل الوصول للحجم المطلوب، مما يخل بنسبة مانع التجلط إلى الدم فتصبح الوحدة غير صالحة.'
                }
            }
        };

        let rejectionChartInstance = null;

        // --- Navigation Logic ---
        function switchTab(tabId) {
            appState.currentTab = tabId;

            // تحديث جميع الأقسام وإخفائها (خمسة الآن)
            ['principles', 'operations', 'quality', 'kpi', 'pdf'].forEach(id => {
                document.getElementById(`section-${id}`).classList.add('hidden');
                document.getElementById(`tab-${id}`).classList.replace('active-tab', 'inactive-tab');
            });

            // إظهار القسم المطلوب
            document.getElementById(`section-${tabId}`).classList.remove('hidden');
            document.getElementById(`tab-${tabId}`).classList.replace('inactive-tab', 'active-tab');

            if (tabId === 'quality') {
                renderRejectionChart();
            }
        }

        // --- Chart.js Implementation (Quality Section) ---
        function renderRejectionChart() {
            const ctx = document.getElementById('rejectionChart').getContext('2d');
            if (rejectionChartInstance) {
                rejectionChartInstance.destroy();
            }
            rejectionChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: appState.rejectionData.labels,
                    datasets: [{
                        data: appState.rejectionData.data,
                        backgroundColor: appState.rejectionData.colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { family: 'Cairo', size: 12 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    onClick: (evt, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const label = appState.rejectionData.labels[index];
                            updateRejectionDetails(label);
                        }
                    }
                }
            });
        }

        // --- Dynamic Content Update (Quality Section) ---
        function updateRejectionDetails(label) {
            const desc = appState.rejectionData.descriptions[label];
            const container = document.getElementById('rejection-details');
            container.innerHTML = `
                <div class="bg-white p-4 rounded border-r-4 border-red-500 shadow-sm fade-in">
                    <h4 class="font-bold text-lg text-gray-800 mb-2">${label}</h4>
                    <p class="text-gray-600">${desc}</p>
                </div>
            `;
        }

        // --- Calculator Logic (KPI Section) ---
        function calculateViralRate() {
            const total = parseFloat(document.getElementById('total-donations-input').value);
            const positive = parseFloat(document.getElementById('positive-cases-input').value);
            if (total > 0) {
                const rate = ((positive / total) * 100).toFixed(2);
                document.getElementById('viral-rate-result').innerText = rate + '%';
            } else {
                document.getElementById('viral-rate-result').innerText = 'خطأ';
            }
        }

        function calculateExpiryRate() {
            const total = parseFloat(document.getElementById('total-stock-input').value);
            const expired = parseFloat(document.getElementById('expired-units-input').value);
            if (total > 0) {
                const rate = ((expired / total) * 100).toFixed(2);
                document.getElementById('expiry-rate-result').innerText = rate + '%';
            } else {
                document.getElementById('expiry-rate-result').innerText = 'خطأ';
            }
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            switchTab('principles');
        });
    </script>
</body>
</html>